<div class="w-full">
  <div class="mb-6">
    <%= link_to settlement.gatherings_path, class: "inline-flex items-center gap-1 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors duration-200" do %>
      <%= lucide_icon "arrow-left", class: "w-4 h-4" %>
      정산 목록
    <% end %>
  </div>

  <%# 모임 헤더 %>
  <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden p-4 sm:p-6 mb-6">
    <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
      <div class="min-w-0">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white break-words"><%= @gathering.title %></h1>
        <% if @gathering.gathering_date.present? %>
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
            <%= lucide_icon "calendar", class: "w-4 h-4 inline mr-1" %>
            <%= @gathering.gathering_date.strftime("%Y년 %m월 %d일") %>
          </p>
        <% end %>
        <% if @gathering.memo.present? %>
          <p class="mt-2 text-sm text-gray-600 dark:text-gray-400"><%= @gathering.memo %></p>
        <% end %>
      </div>
      <div class="flex items-center gap-2 flex-shrink-0">
        <%= link_to settlement.result_gathering_path(@gathering), class: "inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 dark:hover:bg-blue-500 transition-colors duration-200" do %>
          <%= lucide_icon "calculator", class: "w-4 h-4 mr-1" %>
          정산
        <% end %>
        <%= link_to settlement.edit_gathering_path(@gathering), class: "inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200" do %>
          <%= lucide_icon "pencil", class: "w-4 h-4 mr-1" %>
          수정
        <% end %>
        <%= button_to settlement.gathering_path(@gathering), method: :delete, class: "inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md text-red-600 dark:text-red-400 border border-red-300 dark:border-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors duration-200", data: { turbo_confirm: "정말 삭제하시겠습니까? 모든 라운드와 항목이 삭제됩니다." } do %>
          <%= lucide_icon "trash-2", class: "w-4 h-4 mr-1" %>
          삭제
        <% end %>
      </div>
    </div>
  </div>

  <%# 참석자 섹션 %>
  <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden p-4 sm:p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
      <%= lucide_icon "users", class: "w-5 h-5 inline mr-1" %>
      참석자 (<%= @gathering.members.count %>명)
    </h2>

    <div class="flex flex-wrap gap-2 mb-4">
      <% @gathering.members.each do |member| %>
        <div class="inline-flex items-center gap-1 px-3 py-1.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-full text-sm">
          <span><%= member.name %></span>
          <%= button_to settlement.gathering_member_path(@gathering, member), method: :delete, class: "text-gray-400 hover:text-red-500 dark:hover:text-red-400 transition-colors duration-200", data: { turbo_confirm: "#{member.name}님을 삭제하시겠습니까?" } do %>
            <%= lucide_icon "x", class: "w-3.5 h-3.5" %>
          <% end %>
        </div>
      <% end %>
    </div>

    <%= form_with(model: Settlement::Member.new, url: settlement.gathering_members_path(@gathering), class: "flex items-center gap-2") do |form| %>
      <%= form.text_field :name, placeholder: "참석자 이름", required: true,
          class: "bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 rounded-md px-3 py-1.5 text-sm transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
      <%= form.submit "추가", class: "inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 dark:hover:bg-blue-500 transition-colors duration-200 cursor-pointer" %>
    <% end %>
  </div>

  <%# 라운드 섹션 %>
  <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden p-4 sm:p-6">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
        <%= lucide_icon "layers", class: "w-5 h-5 inline mr-1" %>
        라운드 (<%= @gathering.rounds.count %>개)
      </h2>
      <% if @gathering.members.any? %>
        <%= link_to settlement.new_gathering_round_path(@gathering), class: "self-start flex-shrink-0 inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 dark:hover:bg-blue-500 transition-colors duration-200" do %>
          <%= lucide_icon "plus", class: "w-4 h-4 mr-1" %>
          라운드 추가
        <% end %>
      <% end %>
    </div>

    <% if @gathering.rounds.any? %>
      <div class="space-y-3">
        <% @gathering.rounds.order(:position, :id).each do |round| %>
          <%= link_to settlement.gathering_round_path(@gathering, round), class: "block group" do %>
            <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:border-blue-300 dark:hover:border-blue-500 transition-colors duration-200">
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-4">
                <div class="min-w-0">
                  <h3 class="font-medium text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-200">
                    <%= round.name %>
                  </h3>
                  <p class="text-sm text-gray-500 dark:text-gray-400 mt-0.5">
                    참석자 <%= round.members.count %>명 · 항목 <%= round.items.count %>개
                  </p>
                </div>
                <div class="sm:text-right flex-shrink-0">
                  <p class="text-lg font-semibold text-gray-900 dark:text-white">
                    <%= number_to_currency(round.total_amount, unit: "₩", precision: 0) %>
                  </p>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-8">
        <% if @gathering.members.any? %>
          <%= lucide_icon "layers", class: "mx-auto h-10 w-10 text-gray-400 dark:text-gray-500" %>
          <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">라운드를 추가하여 항목을 입력하세요.</p>
        <% else %>
          <%= lucide_icon "users", class: "mx-auto h-10 w-10 text-gray-400 dark:text-gray-500" %>
          <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">먼저 참석자를 추가한 후 라운드를 만들 수 있습니다.</p>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
