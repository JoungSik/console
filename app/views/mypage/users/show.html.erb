<% content_for(:title) { t('settings.mypage.title') } %>

<div class="w-full">
  <!-- 페이지 헤더 -->
  <div class="mb-8">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white">
      <%= t('settings.mypage.title') %>
    </h1>
  </div>

  <!-- 프로필 정보 카드 -->
  <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm mb-6">
    <div class="p-6">
      <div class="flex items-center mb-4">
        <%= lucide_icon "user", class: "w-6 h-6 text-blue-600 dark:text-blue-400 mr-3" %>
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
          <%= t('settings.profile.title') %>
        </h2>
      </div>

      <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">
        <%= t('settings.profile.description') %>
      </p>

      <dl class="space-y-4">
        <div class="flex flex-col sm:flex-row sm:items-center">
          <dt class="text-sm font-medium text-gray-700 dark:text-gray-300 sm:w-32">
            <%= t('forms.labels.name') %>
          </dt>
          <dd class="mt-1 sm:mt-0 text-sm text-gray-900 dark:text-white">
            <%= current_user.name %>
          </dd>
        </div>
        <div class="flex flex-col sm:flex-row sm:items-center">
          <dt class="text-sm font-medium text-gray-700 dark:text-gray-300 sm:w-32">
            <%= t('forms.labels.email_address') %>
          </dt>
          <dd class="mt-1 sm:mt-0 text-sm text-gray-900 dark:text-white">
            <%= current_user.email_address %>
          </dd>
        </div>
      </dl>
    </div>
  </div>

  <!-- 비밀번호 변경 카드 -->
  <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm mb-6">
    <div class="p-6">
      <div class="flex items-center mb-4">
        <%= lucide_icon "lock", class: "w-6 h-6 text-blue-600 dark:text-blue-400 mr-3" %>
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
          <%= t('settings.password.title') %>
        </h2>
      </div>

      <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">
        <%= t('settings.password.description') %>
      </p>

      <%= form_with url: mypage_user_path, method: :patch, scope: :user, class: "space-y-4" do |form| %>
        <div>
          <%= form.label :current_password, t('settings.password.current_password'),
              class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
          <%= form.password_field :current_password,
              required: true,
              autocomplete: "current-password",
              class: "w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 rounded-md px-3 py-2 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
        </div>

        <div>
          <%= form.label :password, t('settings.password.new_password'),
              class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
          <%= form.password_field :password,
              required: true,
              autocomplete: "new-password",
              class: "w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 rounded-md px-3 py-2 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
        </div>

        <div>
          <%= form.label :password_confirmation, t('settings.password.confirm_password'),
              class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
          <%= form.password_field :password_confirmation,
              required: true,
              autocomplete: "new-password",
              class: "w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 rounded-md px-3 py-2 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
        </div>

        <div class="pt-2">
          <%= form.submit t('settings.password.change_button'),
              class: "inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 dark:hover:bg-blue-500 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- 플러그인 설정 카드 -->
  <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm mb-6">
    <div class="p-6">
      <div class="flex items-start sm:items-center justify-between gap-3">
        <div class="flex items-start sm:items-center min-w-0">
          <%= lucide_icon "puzzle", class: "w-6 h-6 text-blue-600 dark:text-blue-400 mr-3 flex-shrink-0 mt-0.5 sm:mt-0" %>
          <div class="min-w-0">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
              <%= t('settings.plugins.title') %>
            </h2>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              <%= t('settings.plugins.short_description') %>
            </p>
          </div>
        </div>
        <%= link_to mypage_plugins_path,
            class: "flex-shrink-0 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors duration-200 text-sm font-medium whitespace-nowrap" do %>
          <%= t('actions.show') %> →
        <% end %>
      </div>
    </div>
  </div>

  <!-- 푸시 알림 설정 카드 -->
  <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm"
       data-controller="push-subscription"
       data-push-subscription-vapid-public-key-value="<%= Rails.application.credentials.dig(:vapid, :public_key) %>">
    <div class="p-6">
      <div class="flex items-center mb-4">
        <%= lucide_icon "bell", class: "w-6 h-6 text-blue-600 dark:text-blue-400 mr-3" %>
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
          <%= t('settings.push_notifications.title') %>
        </h2>
      </div>

      <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">
        <%= t('settings.push_notifications.description') %>
      </p>

      <div class="flex flex-col sm:flex-row gap-3">
        <!-- 구독 버튼 -->
        <button type="button"
                data-push-subscription-target="subscribeButton"
                data-action="click->push-subscription#subscribe"
                class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 dark:hover:bg-blue-500 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800">
          <%= lucide_icon "bell-plus", class: "w-4 h-4 mr-2" %>
          <%= t('settings.push_notifications.subscribe') %>
        </button>

        <!-- 구독 취소 버튼 -->
        <button type="button"
                data-push-subscription-target="unsubscribeButton"
                data-action="click->push-subscription#unsubscribe"
                class="hidden inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800">
          <%= lucide_icon "bell-off", class: "w-4 h-4 mr-2" %>
          <%= t('settings.push_notifications.unsubscribe') %>
        </button>
      </div>

      <!-- 상태 메시지 -->
      <p data-push-subscription-target="status" class="hidden mt-3 text-sm"></p>
    </div>
  </div>

  <!-- 로그아웃 카드 -->
  <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm mt-6">
    <div class="p-6">
      <div class="flex items-center mb-4">
        <%= lucide_icon "log-out", class: "w-6 h-6 text-red-500 dark:text-red-400 mr-3" %>
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
          <%= t('navigation.logout') %>
        </h2>
      </div>

      <%= link_to t('navigation.logout'), main_app.session_path,
          data: { turbo_method: :delete, turbo_confirm: t('confirmations.logout') },
          class: "inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 dark:hover:bg-red-500 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 dark:focus:ring-offset-gray-800" %>
    </div>
  </div>
</div>
